<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mohammed Saqhib | Drive Through My Portfolio</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="photos/logo.png" />
    <style>
        :root {
            --primary: #00d4ff;
            --secondary: #ff6b6b;
            --accent: #4ecdc4;
            --dark: #1a1a1a;
            --light: #ffffff;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--dark);
            color: var(--light);
            overflow: hidden;
            user-select: none;
        }

        canvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-title {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
        }

        .loading-subtitle {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.8;
            text-align: center;
        }

        .loading-progress {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* UI Overlay */
        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .header-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-link {
            color: var(--light);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .nav-link:hover {
            color: var(--primary);
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Controls */
        .controls-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: auto;
        }

        .controls-title {
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .control-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .control-key {
            background: var(--primary);
            color: var(--dark);
            padding: 4px 8px;
            border-radius: 5px;
            font-weight: 600;
            margin-right: 10px;
            min-width: 30px;
            text-align: center;
        }

        /* Speed & Stats */
        .stats-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            pointer-events: auto;
        }

        .speed-display {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .speed-label {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* Info Panel */
        .info-panel {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 400px;
            max-height: 70vh;
            overflow-y: auto;
            opacity: 0;
            transform: translateY(-50%) translateX(450px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto;
        }

        .info-panel.visible {
            opacity: 1;
            transform: translateY(-50%) translateX(0);
        }

        .info-panel h2 {
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .info-panel h3 {
            color: var(--accent);
            font-size: 1.2rem;
            font-weight: 600;
            margin: 20px 0 10px 0;
        }

        .info-panel p {
            line-height: 1.6;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.9);
        }

        .info-panel ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .info-panel li {
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .skill-tag {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: var(--dark);
            padding: 8px 12px;
            border-radius: 20px;
            text-align: center;
            font-weight: 600;
            font-size: 0.8rem;
            transition: transform 0.3s ease;
        }

        .skill-tag:hover {
            transform: translateY(-3px) scale(1.05);
        }

        /* Interaction Hint */
        .interaction-hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: var(--light);
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: 600;
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .interaction-hint.visible {
            opacity: 1;
        }

        /* Minimap */
        .minimap {
            position: absolute;
            top: 100px;
            left: 20px;
            width: 200px;
            height: 150px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            pointer-events: auto;
        }

        .minimap-title {
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }

        .map-container {
            position: relative;
            width: 100%;
            height: 100px;
            background: linear-gradient(to bottom, #87CEEB, #228B22);
            border-radius: 10px;
            overflow: hidden;
        }

        .map-car {
            position: absolute;
            width: 8px;
            height: 12px;
            background: var(--secondary);
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-ui {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-links {
                display: none;
            }
            
            .controls-panel, .stats-panel {
                bottom: 10px;
                left: 10px;
                right: 10px;
                max-width: none;
            }
            
            .minimap {
                display: none;
            }
            
            .info-panel {
                right: 10px;
                left: 10px;
                max-width: none;
                transform: translateY(-50%) translateY(100vh);
            }
            
            .info-panel.visible {
                transform: translateY(-50%) translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-title">MOHAMMED SAQHIB</div>
        <div class="loading-subtitle">Drive Through My Portfolio</div>
        <div class="loading-progress">
            <div class="loading-bar" id="loadingBar"></div>
        </div>
    </div>

    <!-- UI Overlay -->
    <div class="ui-overlay">
        <!-- Header -->
        <div class="header-ui">
            <div class="logo">MS PORTFOLIO</div>
            <div class="nav-links">
                <a href="#" class="nav-link">About</a>
                <a href="#" class="nav-link">Skills</a>
                <a href="#" class="nav-link">Projects</a>
                <a href="#" class="nav-link">Contact</a>
                <a href="index.html" class="nav-link">← Back</a>
            </div>
        </div>

        <!-- Controls Panel -->
        <div class="controls-panel">
            <div class="controls-title">🚗 Drive Controls</div>
            <div class="control-item">
                <span class="control-key">W</span>
                <span>Accelerate</span>
            </div>
            <div class="control-item">
                <span class="control-key">S</span>
                <span>Brake / Reverse</span>
            </div>
            <div class="control-item">
                <span class="control-key">A</span>
                <span>Steer Left</span>
            </div>
            <div class="control-item">
                <span class="control-key">D</span>
                <span>Steer Right</span>
            </div>
            <div class="control-item">
                <span class="control-key">R</span>
                <span>Reset Car</span>
            </div>
        </div>

        <!-- Stats Panel -->
        <div class="stats-panel">
            <div class="speed-display" id="speedDisplay">0</div>
            <div class="speed-label">km/h</div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="distanceValue">0</div>
                    <div class="stat-label">Distance</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="objectsFound">0</div>
                    <div class="stat-label">Found</div>
                </div>
            </div>
        </div>

        <!-- Minimap -->
        <div class="minimap">
            <div class="minimap-title">Portfolio Map</div>
            <div class="map-container">
                <div class="map-car" id="mapCar"></div>
            </div>
        </div>
    </div>

    <!-- Info Panel -->
    <div class="info-panel" id="infoPanel">
        <h2 id="panelTitle">Welcome to My World</h2>
        <div id="panelContent">
            <p>Welcome to my interactive 3D portfolio! Drive around this virtual world to explore my professional journey.</p>
            <p>🚗 Use WASD keys to drive the car and discover interactive objects scattered throughout the world.</p>
            <p>🌟 Each object represents a different aspect of my career - from skills to projects to achievements.</p>
        </div>
    </div>

    <!-- Interaction Hint -->
    <div class="interaction-hint" id="interactionHint">
        Press E to interact
    </div>

    <!-- Three.js Scripts -->
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/",
            "cannon-es": "https://unpkg.com/cannon-es@0.20.0/dist/cannon-es.js"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import * as CANNON from 'cannon-es';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { FontLoader } from 'three/addons/loaders/FontLoader.js';
        import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';

        // ===== GLOBAL VARIABLES =====
        let scene, camera, renderer, world, clock;
        let carBody, carMesh, vehicleConstraints = [];
        let wheelBodies = [], wheelMeshes = [];
        let currentSpeed = 0, distance = 0, objectsFound = 0;
        let interactiveObjects = [];
        let currentInteractionZone = null;

        // Input handling
        const keys = {};
        const interactionKeys = {};

        // ===== PORTFOLIO DATA =====
        const portfolioData = {
            about: {
                title: "About Me",
                content: `
                    <p>I am an aspiring Data Science and Analytics Professional with a strong foundation in data analysis, visualization, and engineering.</p>
                    <h3>🎯 Background</h3>
                    <p>Based in Bengaluru, India, I bring together technical expertise and analytical thinking to solve real-world problems through data-driven approaches.</p>
                    <h3>💡 What Drives Me</h3>
                    <p>I'm passionate about leveraging data to create meaningful impact and building intelligent solutions that make a difference.</p>
                `
            },
            skills: {
                title: "Technical Skills",
                content: `
                    <p>My technical expertise spans across multiple domains of data science and analytics:</p>
                    <h3>💻 Programming Languages</h3>
                    <div class="skills-grid">
                        <div class="skill-tag">Python</div>
                        <div class="skill-tag">R</div>
                        <div class="skill-tag">SQL</div>
                        <div class="skill-tag">JavaScript</div>
                    </div>
                    <h3>📊 Data Tools</h3>
                    <div class="skills-grid">
                        <div class="skill-tag">Power BI</div>
                        <div class="skill-tag">Tableau</div>
                        <div class="skill-tag">Excel</div>
                        <div class="skill-tag">Pandas</div>
                    </div>
                    <h3>🤖 Machine Learning</h3>
                    <div class="skills-grid">
                        <div class="skill-tag">TensorFlow</div>
                        <div class="skill-tag">Scikit-learn</div>
                        <div class="skill-tag">PyTorch</div>
                        <div class="skill-tag">Keras</div>
                    </div>
                `
            },
            projects: {
                title: "Featured Projects",
                content: `
                    <p>Here are some of my featured projects that showcase my skills:</p>
                    <h3>🚀 Recent Projects</h3>
                    <ul>
                        <li><strong>Advanced Stock Prediction Dashboard:</strong> ML-powered stock analysis platform</li>
                        <li><strong>Fraud Detection System:</strong> Real-time fraud detection using machine learning</li>
                        <li><strong>Netflix Household Verification:</strong> User verification system</li>
                        <li><strong>Formula 1 Data Hub:</strong> Comprehensive F1 data analysis platform</li>
                        <li><strong>AI CSV Dashboard Generator:</strong> Automated dashboard creation tool</li>
                    </ul>
                `
            },
            contact: {
                title: "Let's Connect",
                content: `
                    <p>Ready to collaborate or discuss opportunities? I'd love to hear from you!</p>
                    <h3>📧 Get in Touch</h3>
                    <p>Whether you're looking for a data scientist, need help with a project, or just want to connect, feel free to reach out!</p>
                    <h3>💼 What I Offer</h3>
                    <ul>
                        <li>Data Science and Analytics Solutions</li>
                        <li>Machine Learning Model Development</li>
                        <li>Dashboard and Visualization Creation</li>
                        <li>Database Design and Management</li>
                        <li>Consultation and Freelance Services</li>
                    </ul>
                `
            }
        };

        // ===== INITIALIZATION =====
        function init() {
            // Create Three.js scene
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x263238, 100, 1000);
            
            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 20);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.setClearColor(0x263238);
            document.body.appendChild(renderer.domElement);
            
            // Create physics world
            world = new CANNON.World({
                gravity: new CANNON.Vec3(0, -9.82, 0)
            });
            world.broadphase = new CANNON.NaiveBroadphase();
            
            // Create clock
            clock = new THREE.Clock();
            
            // Setup scene
            setupLighting();
            createGround();
            createCar();
            createEnvironment();
            createInteractiveObjects();
            
            // Setup controls
            setupControls();
            
            // Start animation loop
            animate();
            
            // Hide loading screen
            setTimeout(hideLoadingScreen, 2000);
        }

        // ===== LIGHTING SETUP =====
        function setupLighting() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            // Directional light (sun)
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(50, 50, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 500;
            directionalLight.shadow.camera.left = -100;
            directionalLight.shadow.camera.right = 100;
            directionalLight.shadow.camera.top = 100;
            directionalLight.shadow.camera.bottom = -100;
            scene.add(directionalLight);
            
            // Point lights for atmosphere
            const pointLight1 = new THREE.PointLight(0x00d4ff, 0.5, 100);
            pointLight1.position.set(-50, 20, -50);
            scene.add(pointLight1);
            
            const pointLight2 = new THREE.PointLight(0xff6b6b, 0.5, 100);
            pointLight2.position.set(50, 20, 50);
            scene.add(pointLight2);
        }

        // ===== GROUND CREATION =====
        function createGround() {
            // Ground geometry
            const groundGeometry = new THREE.PlaneGeometry(200, 200);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x4a7c59,
                transparent: true,
                opacity: 0.8
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Ground physics
            const groundShape = new CANNON.Plane();
            const groundBody = new CANNON.Body({ mass: 0 });
            groundBody.addShape(groundShape);
            groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);
            world.addBody(groundBody);
        }

        // ===== CAR CREATION =====
        function createCar() {
            // Car body (simple box for now)
            const carGeometry = new THREE.BoxGeometry(4, 1.5, 2);
            const carMaterial = new THREE.MeshLambertMaterial({ color: 0xff6b6b });
            carMesh = new THREE.Mesh(carGeometry, carMaterial);
            carMesh.position.set(0, 3, 0);
            carMesh.castShadow = true;
            scene.add(carMesh);
            
            // Car physics body
            const carShape = new CANNON.Box(new CANNON.Vec3(2, 0.75, 1));
            carBody = new CANNON.Body({ mass: 150 });
            carBody.addShape(carShape);
            carBody.position.set(0, 3, 0);
            carBody.material = new CANNON.Material({ friction: 0.4, restitution: 0.3 });
            world.addBody(carBody);
            
            // Create wheels
            createWheels();
        }

        // ===== WHEEL CREATION =====
        function createWheels() {
            const wheelGeometry = new THREE.CylinderGeometry(0.5, 0.5, 0.3, 8);
            const wheelMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            
            const wheelShape = new CANNON.Cylinder(0.5, 0.5, 0.3, 8);
            const wheelMaterial_physics = new CANNON.Material({ friction: 1.5, restitution: 0.3 });
            
            const wheelPositions = [
                { x: -1.5, z: 1.2 },   // Front left
                { x: 1.5, z: 1.2 },    // Front right
                { x: -1.5, z: -1.2 },  // Rear left
                { x: 1.5, z: -1.2 }    // Rear right
            ];
            
            wheelPositions.forEach((pos, index) => {
                // Visual wheel
                const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
                wheel.rotation.z = Math.PI / 2;
                wheelMeshes.push(wheel);
                scene.add(wheel);
                
                // Physics wheel
                const wheelBody = new CANNON.Body({ mass: 10 });
                wheelBody.addShape(wheelShape);
                wheelBody.material = wheelMaterial_physics;
                wheelBodies.push(wheelBody);
                world.addBody(wheelBody);
                
                // Constraint to connect wheel to car
                const constraint = new CANNON.PointToPointConstraint(
                    carBody,
                    new CANNON.Vec3(pos.x, -0.5, pos.z),
                    wheelBody,
                    new CANNON.Vec3(0, 0, 0)
                );
                world.addConstraint(constraint);
                vehicleConstraints.push(constraint);
            });
        }

        // ===== ENVIRONMENT CREATION =====
        function createEnvironment() {
            // Create trees
            for (let i = 0; i < 20; i++) {
                createTree(
                    (Math.random() - 0.5) * 150,
                    0,
                    (Math.random() - 0.5) * 150
                );
            }
            
            // Create buildings/structures
            for (let i = 0; i < 10; i++) {
                createBuilding(
                    (Math.random() - 0.5) * 120,
                    0,
                    (Math.random() - 0.5) * 120
                );
            }
        }

        // ===== TREE CREATION =====
        function createTree(x, y, z) {
            const treeGroup = new THREE.Group();
            
            // Trunk
            const trunkGeometry = new THREE.CylinderGeometry(0.5, 0.8, 6);
            const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8b4513 });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            trunk.position.y = 3;
            trunk.castShadow = true;
            treeGroup.add(trunk);
            
            // Foliage
            const foliageGeometry = new THREE.SphereGeometry(3, 8, 8);
            const foliageMaterial = new THREE.MeshLambertMaterial({ color: 0x228b22 });
            const foliage = new THREE.Mesh(foliageGeometry, foliageMaterial);
            foliage.position.y = 7;
            foliage.castShadow = true;
            treeGroup.add(foliage);
            
            treeGroup.position.set(x, y, z);
            scene.add(treeGroup);
        }

        // ===== BUILDING CREATION =====
        function createBuilding(x, y, z) {
            const height = 5 + Math.random() * 10;
            const buildingGeometry = new THREE.BoxGeometry(
                3 + Math.random() * 2,
                height,
                3 + Math.random() * 2
            );
            const buildingMaterial = new THREE.MeshLambertMaterial({ 
                color: new THREE.Color().setHSL(Math.random(), 0.5, 0.6) 
            });
            const building = new THREE.Mesh(buildingGeometry, buildingMaterial);
            building.position.set(x, height / 2, z);
            building.castShadow = true;
            building.receiveShadow = true;
            scene.add(building);
        }

        // ===== INTERACTIVE OBJECTS =====
        function createInteractiveObjects() {
            const objectTypes = ['about', 'skills', 'projects', 'contact'];
            const colors = [0x00d4ff, 0xff6b6b, 0x4ecdc4, 0xfeca57];
            
            objectTypes.forEach((type, index) => {
                const geometry = new THREE.SphereGeometry(2, 16, 16);
                const material = new THREE.MeshLambertMaterial({ 
                    color: colors[index],
                    transparent: true,
                    opacity: 0.8
                });
                const sphere = new THREE.Mesh(geometry, material);
                
                // Position objects around the world
                const angle = (index / objectTypes.length) * Math.PI * 2;
                const radius = 30;
                sphere.position.set(
                    Math.cos(angle) * radius,
                    3,
                    Math.sin(angle) * radius
                );
                sphere.castShadow = true;
                
                // Add floating animation
                sphere.userData = {
                    type: type,
                    originalY: sphere.position.y,
                    floatSpeed: 0.02 + Math.random() * 0.01
                };
                
                interactiveObjects.push(sphere);
                scene.add(sphere);
                
                // Add text label above object
                createFloatingText(type.toUpperCase(), sphere.position.clone().add(new THREE.Vector3(0, 4, 0)));
            });
        }

        // ===== FLOATING TEXT =====
        function createFloatingText(text, position) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 64;
            
            context.fillStyle = '#ffffff';
            context.font = 'bold 24px Inter';
            context.textAlign = 'center';
            context.fillText(text, 128, 40);
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(material);
            sprite.position.copy(position);
            sprite.scale.set(8, 2, 1);
            scene.add(sprite);
        }

        // ===== CONTROLS SETUP =====
        function setupControls() {
            document.addEventListener('keydown', (event) => {
                keys[event.code] = true;
                if (event.code === 'KeyE') {
                    interactionKeys['KeyE'] = true;
                }
                if (event.code === 'KeyR') {
                    resetCar();
                }
            });
            
            document.addEventListener('keyup', (event) => {
                keys[event.code] = false;
                interactionKeys['KeyE'] = false;
            });
        }

        // ===== CAR PHYSICS UPDATE =====
        function updateCarPhysics() {
            const force = 300;
            const brakeForce = 600;
            
            // Reset car if it falls
            if (carBody.position.y < -10) {
                resetCar();
            }
            
            // Apply forces based on input
            if (keys['KeyW']) {
                carBody.applyLocalForce(new CANNON.Vec3(0, 0, force), new CANNON.Vec3(0, 0, 0));
            }
            if (keys['KeyS']) {
                carBody.applyLocalForce(new CANNON.Vec3(0, 0, -brakeForce), new CANNON.Vec3(0, 0, 0));
            }
            if (keys['KeyA']) {
                carBody.angularVelocity.y += 0.1;
            }
            if (keys['KeyD']) {
                carBody.angularVelocity.y -= 0.1;
            }
            
            // Apply some air resistance
            carBody.velocity.x *= 0.98;
            carBody.velocity.z *= 0.98;
            carBody.angularVelocity.y *= 0.95;
            
            // Update visual car position
            carMesh.position.copy(carBody.position);
            carMesh.quaternion.copy(carBody.quaternion);
            
            // Update wheels
            wheelBodies.forEach((wheelBody, index) => {
                wheelMeshes[index].position.copy(wheelBody.position);
                wheelMeshes[index].quaternion.copy(wheelBody.quaternion);
            });
            
            // Calculate speed
            const velocity = carBody.velocity;
            currentSpeed = Math.sqrt(velocity.x * velocity.x + velocity.z * velocity.z) * 3.6; // Convert to km/h
            
            // Update distance
            distance += currentSpeed * 0.016; // Rough calculation
        }

        // ===== CAMERA UPDATE =====
        function updateCamera() {
            // Follow the car with smooth camera movement
            const carPosition = carMesh.position;
            const targetCameraPosition = new THREE.Vector3(
                carPosition.x - 15 * Math.sin(carMesh.rotation.y),
                carPosition.y + 8,
                carPosition.z - 15 * Math.cos(carMesh.rotation.y)
            );
            
            camera.position.lerp(targetCameraPosition, 0.05);
            camera.lookAt(carPosition);
        }

        // ===== INTERACTION SYSTEM =====
        function checkInteractions() {
            const carPosition = carMesh.position;
            let nearestObject = null;
            let nearestDistance = Infinity;
            
            interactiveObjects.forEach(obj => {
                const distance = carPosition.distanceTo(obj.position);
                if (distance < 8 && distance < nearestDistance) {
                    nearestObject = obj;
                    nearestDistance = distance;
                }
            });
            
            if (nearestObject && nearestObject !== currentInteractionZone) {
                currentInteractionZone = nearestObject;
                showInteractionHint();
            } else if (!nearestObject && currentInteractionZone) {
                currentInteractionZone = null;
                hideInteractionHint();
                hideInfoPanel();
            }
            
            // Handle interaction
            if (currentInteractionZone && interactionKeys['KeyE']) {
                showInfoPanel(currentInteractionZone.userData.type);
                objectsFound++;
                interactionKeys['KeyE'] = false; // Prevent multiple triggers
            }
        }

        // ===== UI UPDATES =====
        function updateUI() {
            document.getElementById('speedDisplay').textContent = Math.round(currentSpeed);
            document.getElementById('distanceValue').textContent = Math.round(distance / 1000);
            document.getElementById('objectsFound').textContent = objectsFound;
            
            // Update minimap car position
            const mapCar = document.getElementById('mapCar');
            const carPos = carMesh.position;
            const mapX = ((carPos.x + 100) / 200) * 100;
            const mapZ = ((carPos.z + 100) / 200) * 100;
            mapCar.style.left = mapX + '%';
            mapCar.style.top = mapZ + '%';
        }

        // ===== RESET CAR =====
        function resetCar() {
            carBody.position.set(0, 5, 0);
            carBody.velocity.set(0, 0, 0);
            carBody.angularVelocity.set(0, 0, 0);
            carBody.quaternion.set(0, 0, 0, 1);
        }

        // ===== UI FUNCTIONS =====
        function showInteractionHint() {
            document.getElementById('interactionHint').classList.add('visible');
        }

        function hideInteractionHint() {
            document.getElementById('interactionHint').classList.remove('visible');
        }

        function showInfoPanel(type) {
            const panel = document.getElementById('infoPanel');
            const title = document.getElementById('panelTitle');
            const content = document.getElementById('panelContent');
            
            const data = portfolioData[type];
            title.textContent = data.title;
            content.innerHTML = data.content;
            
            panel.classList.add('visible');
        }

        function hideInfoPanel() {
            document.getElementById('infoPanel').classList.remove('visible');
        }

        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.style.opacity = '0';
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 1000);
        }

        // ===== ANIMATION LOOP =====
        function animate() {
            requestAnimationFrame(animate);
            
            const deltaTime = clock.getDelta();
            
            // Update physics
            world.step(deltaTime);
            
            // Update car physics
            updateCarPhysics();
            
            // Update camera
            updateCamera();
            
            // Check interactions
            checkInteractions();
            
            // Update UI
            updateUI();
            
            // Animate interactive objects
            interactiveObjects.forEach(obj => {
                obj.position.y = obj.userData.originalY + Math.sin(Date.now() * obj.userData.floatSpeed) * 0.5;
                obj.rotation.y += 0.01;
            });
            
            // Render scene
            renderer.render(scene, camera);
        }

        // ===== WINDOW RESIZE =====
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // ===== LOADING PROGRESS =====
        function updateLoadingProgress() {
            const loadingBar = document.getElementById('loadingBar');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                }
                loadingBar.style.width = progress + '%';
            }, 100);
        }

        // ===== START EVERYTHING =====
        updateLoadingProgress();
        init();

    </script>
</body>
</html>
